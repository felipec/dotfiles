#!/bin/bash

cmp_all () {
  readarray -t files < <(git ls-files)

  for f in "${files[@]}"; do
    if [[ -e ~/"$f" ]]
    then
      cmp -s {.,~}/"$f" || vimdiff {.,~}/"$f"
    else
      mkdir -p $(dirname ~/"$f") &&
      cp -av ./"$f" ~/"$f"
    fi
  done
}

cmp_all
