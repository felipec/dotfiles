#!/bin/bash

cmp_all () {
  readarray -t files < <(git ls-files)

  for f in "${files[@]}"; do
    [[ "$f" == tools/* ]] && continue
    if [[ -e ~/"$f" ]]
    then
      cmp -s {.,~}/"$f" || vimdiff {.,~}/"$f"
    else
      mkdir -p $(dirname ~/"$f") &&
      cp -av ./"$f" ~/"$f"
    fi
  done
}

# extra

setup () {
  xdg-user-dirs-update --force
  sudo chsh -s /bin/zsh felipec

  url='https://raw.githubusercontent.com/tpope/vim-pathogen/master'

  mkdir -p ~/.vim/autoload/ ~/.vim/bundle/
  test -f ~/.vim/autoload/pathogen.vim || curl -o ~/.vim/autoload/pathogen.vim "${url}/autoload/pathogen.vim"

  # syntastic
  # vim-airline

  url='https://git.kernel.org/pub/scm/git/git.git/plain/contrib/completion'

  test -f ~/.git-prompt.sh || curl -o ~/.git-prompt.sh "${url}/git-prompt.sh"
  test -f ~/.git-completion.sh || curl -o ~/.git-completion.bash "${url}/git-completion.bash"
  test -f ~/.zsh/_git || curl -o ~/.zsh/_git "${url}/git-completion.zsh"

  chmod go-rw ~/.msmtprc

  # ccache
}

cmp_all
test -f ~/.config/dotfiles-setup || setup && touch ~/.config/dotfiles-setup
